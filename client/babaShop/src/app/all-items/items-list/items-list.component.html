<div class="main-content">
    <div class="container-fluid">

        <div class="card card-plain">
            <div class="card-header " fxLayout="column" fxLayout.lt-sm="row" fxLayoutGap="5px">
                <div fxLayout="row" fxLayoutAlign="start center">
                    <mat-form-field class="dropdown">
                        <mat-label>Filter by</mat-label>
                        <select matNativeControl [(ngModel)]="selectedOption" required>
                            <option label="--select something --"></option>
                            <option value="name">Name</option>
                            <option value="category">Category</option>
                            <option value="brand">Brand</option>
                            <option value="date">By Date</option>
                        </select>
                    </mat-form-field>
                </div>


                <div *ngIf="selectedOption === 'name'" class="name-filter" fxLayout="row"
                    fxLayoutAlign.lt-md="start center">
                    <mat-form-field fxFlex="10%">
                        <input matInput placeholder="Product Name" name="ItemName" [(ngModel)]="itemName"
                            (input)="fetchSuggestions()">
                    </mat-form-field>
                    <div class="suggesion" fxFlex="10%">
                        <mat-option *ngFor="let suggestion of suggestions" (click)="selectSuggestion(suggestion)"
                            (optionSelected)="selectSuggestion($event)">
                            {{suggestion}}
                        </mat-option>
                    </div>


                    <mat-form-field fxFlex="10%" fxHide.lt-md>
                        <mat-label>Category</mat-label>
                        <mat-select [(ngModel)]="selectedCategory">
                            <mat-option *ngFor="let category of Category" [value]="category._id">
                                {{ category.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <mat-form-field fxFlex="10%" fxHide.lt-md>
                        <mat-label>Brand</mat-label>
                        <mat-select [(ngModel)]="selectedBrand">
                            <mat-option *ngFor="let brand of Brands" [value]="brand._id">
                                {{ brand.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>



                <div *ngIf="selectedOption === 'category'" class="name-filter" fxLayout="row"
                    fxLayoutAlign.lt-md="start center">
                    <mat-form-field fxFlex="10%" fxHide.lt-md>
                        <mat-label>Category</mat-label>
                        <mat-select [(ngModel)]="selectedCategory">
                            <mat-option *ngFor="let category of Category" [value]="category._id">
                                {{ category.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <mat-form-field fxFlex="10%" fxHide.lt-md>
                        <mat-label>Brand</mat-label>
                        <mat-select [(ngModel)]="selectedBrand">
                            <mat-option *ngFor="let brand of Brands" [value]="brand._id">
                                {{ brand.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>


                <div *ngIf="selectedOption === 'brand'" class="name-filter" fxLayout="row"
                    fxLayoutAlign.lt-md="start center">
                    <mat-form-field fxFlex="10%" fxHide.lt-md>
                        <mat-label>Brand</mat-label>
                        <mat-select [(ngModel)]="selectedBrand">
                            <mat-option *ngFor="let brand of Brands" [value]="brand._id">
                                {{ brand.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

                <div *ngIf="selectedOption === 'date'" class="name-filter" fxLayout="row" fxLayoutAlign="start center">
                    <mat-form-field>
                        <mat-label>Enter a date range</mat-label>
                        <mat-date-range-input [rangePicker]="picker">
                            <input matStartDate placeholder="Start date" (dateChange)="onStartDateChange($event)">
                            <input matEndDate placeholder="End date" (dateChange)="onEndDateChange($event)">
                        </mat-date-range-input>
                        <mat-hint>MM/DD/YYYY â€“ MM/DD/YYYY</mat-hint>
                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-date-range-picker #picker></mat-date-range-picker>
                    </mat-form-field>
                </div>

                <div class="button-container">
                    <div
                        *ngIf="selectedOption === 'name' || selectedOption === 'category' || selectedOption === 'brand' || selectedOption === 'date'">
                        <button mat-raised-button type="submit" class="btn btn-white btn-round btn-just-icon"
                            (click)="onSearch(paginator.pageIndex + 1, paginator.pageSize)">
                            <i class="material-icons">search</i>
                        </button>
                        <button mat-raised-button type="submit" class="btn btn-white btn-round btn-just-icon"
                            (click)="onClear()">
                            <i class="material-icons">clear</i>
                        </button>
                    </div>
                    <button class="add" mat-raised-button color="primary" (click)="openAddItemModal()"
                        *ngIf="!selectedOption">
                        Add Product
                    </button>
                    <button class="add" mat-raised-button color="primary" (click)="openAddCategoryModal()"
                        *ngIf="!selectedOption">
                        Add Category
                    </button>
                    <button class="add" mat-raised-button color="primary" (click)="openAddBrandModal()"
                        *ngIf="!selectedOption">
                        Add Brand
                    </button>
                </div>

            </div>

        </div>

        <div class="loading" *ngIf="loading">
            <mat-spinner class="loading" color="primary" mode="indeterminate"></mat-spinner>
        </div>

        <div class="card-body">
            <div class="table-responsive">
                <table class="table">
                    <thead class="">
                        <th>
                            Name
                        </th>
                        <th>
                            Brand
                        </th>
                        <th>
                            Category
                        </th>
                        <th>
                            Model
                        </th>
                        <th>
                            variations
                        </th>
                        <th>
                            Size
                        </th>
                        <th>
                            Quantity
                        </th>
                        <th>
                            Price
                        </th>
                        <th>
                            SoldOut
                        </th>

                    </thead>
                    <tbody *ngFor="let item of paginatedItems">

                        <tr>
                            <td (click)="viewItemDetails(item._id)">
                                {{item.name}}
                            </td>
                            <td>
                                {{item?.brand?.name}}
                            </td>
                            <td>
                                {{item?.category?.name}}
                            </td>
                            <td>
                                <ng-container *ngIf="item.models && item.models.length > 0; else displayModel">
                                    <mat-form-field class="modeloption">
                                        <mat-label>Select model</mat-label>
                                        <select matNativeControl [(ngModel)]="item.selectedModel"
                                            (change)="onModelChange(item)">
                                            <option label="Select Model"></option>
                                            <option *ngFor="let model of item.models" [value]="model.model">
                                                {{ model.model }}
                                            </option>
                                        </select>
                                    </mat-form-field>
                                </ng-container>
                                <ng-template #displayModel>
                                    {{ item.model }}
                                </ng-template>
                            </td>
                            <td>
                                <mat-form-field class="modeloption">
                                    <mat-label>Select Variant</mat-label>
                                    <select matNativeControl [(ngModel)]="selectedOrderNumber"
                                        (change)="updateSelectedVariantInfo(item, selectedOrderNumber)">
                                        <option label="Select Variant"></option>
                                        <option *ngFor="let variation of item.selectedModelVariations"
                                            [value]="variation.orderNumber">
                                            {{ variation.orderNumber }}
                                        </option>
                                    </select>
                                </mat-form-field>
                            </td>
                            <td>
                                {{ item.size }}
                            </td>
                            <td>
                                {{ selectedVariant[item._id]?.quantity }}
                            </td>
                            <td>
                                {{ selectedVariant[item._id]?.s_price }}
                            </td>
                            <!-- <td>
                                <span *ngIf="item?.soldOut">Yes</span>
                                <span *ngIf="!item?.soldOut">No</span>
                              </td> -->
                            <td>
                                <span *ngIf="selectedVariant[item._id]?.soldOut" style="color: red;">Yes</span>
                                <span *ngIf="!selectedVariant[item._id]?.soldOut" style="color: green;">No</span>
                            </td>


                            <!-- <td>
                                            <button mat-raised-button type="button" matTooltip="Edit Task"
                                                [matTooltipPosition]="'above'"
                                                class="btn btn-primary btn-link btn-sm btn-just-icon">
                                                <i class="material-icons">edit</i>
                                            </button>
                                            <button mat-raised-button type="button" matTooltip="Remove"
                                                [matTooltipPosition]="'above'"
                                                class="btn btn-danger btn-link btn-sm btn-just-icon">
                                                <i class="material-icons">close</i>
                                            </button>
                                        </td> -->
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <mat-paginator #paginator [length]="totalItems" [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions"
            (page)="onPageChange($event)">
        </mat-paginator>


    </div>